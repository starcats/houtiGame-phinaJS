  <!doctype html>

<html>
  <head>
    <meta charset='utf-8' />
    <title>Particle | phina.js</title>
  </head>
  <body>
  </body>
</html>


<script src='js/phina.js'></script>
<script>
// グローバルに展開
phina.globalize();

var ASSETS = {
  // 画像
  image: {
    'ghost': 'images/ghost.png',
  },
  sound: {
    ghostSE: 'https://cdn.rawgit.com/starcats/houtiGame-phinaJS/c40ca137/sounds/onepoint29.mp3',
  },
};

var targetX = 0;
var targetY = 0;

/*
 * メインシーン
 */
phina.define("MainScene", {
  // 継承
  superClass: 'DisplayScene',
  // コンストラクタ
  init: function() {
    // 親クラス初期化
    this.superInit();
    // 背景
    this.backgroundColor = 'black';
    //this.group = DisplayElement().addChildTo(this);
    this.onpointstart = function(e) {
      // 移動先を設定
      targetX = e.pointer.x;
      targetY = e.pointer.y;
      console.log(this.targetX);
    };
    this.onpointmove = function(e) {
      // 移動先を設定
      targetX = e.pointer.x;
      targetY = e.pointer.y;
      console.log(this.targetX);
    };
  },
  // スプライト画像作成
  update: function(app){
    if (app.frame % 90 === 0) {
      var g = Ghost().addChildTo(this);
      g.setPosition(Random.randint(120,240), Random.randint(200,400));
      //AssetManager.get('sound', 'ghostSE').play();
    }
      /*
     // タッチイベント
    this.onpointstart = function(e) {
      // スプライトをタッチ位置に
      if (this.group.x > e.pointer.x) {
        this.group.x -= 1;
      } else if (this.group.x < e.pointer.x) {
        this.group.x += 1;
      }
      //this.group.y = e.pointer.y;
    };
    */
  },
});

/*
  ゴースト
*/
phina.define("Ghost", {
  superClass: 'Sprite',
  
  init: function() {
    this.superInit('ghost');
    this.vx = Random.randint(-3, 3);
    this.vy = Random.randint(-3, 3);
    
    // タッチを有効
    this.setInteractive(true);  
  },
  update: function(app) {
    this.x += this.vx;
    this.y += this.vy;
    // 画面端との判定
    if (this.left < 0 || 640 < this.right) {
      // 速度を反転する
      this.vx *= -1;
    }
    if (this.top < 0 || 960 < this.bottom) {
      // 速度を反転する
      this.vy *= -1;
    }

    if (app.pointer.getPointing()) {
        // 徐々にタッチした位置に近づける
        
        var moveX = ((targetX - this.x) * 0.1);
        var moveY = ((targetY - this.y) * 0.1);
        this.moveBy(moveX, moveY);
        console.log(this.x);
        console.log(moveX);
        console.log(targetX);
    }
    
  },
});
/*
 * メイン処理
 */
phina.main(function() {
  // アプリケーションを生成
  var app = GameApp({
    startLabel: 'main', // MainScene から開始
    assets: ASSETS,
  });

  // 実行
  app.run();
});

</script>